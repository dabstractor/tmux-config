source-file ~/.config/tmux/tmux.reset.conf

# Set the default terminal to a modern, compatible type for Alacritty.
# Using "xterm-kitty" here was incorrect and likely the root cause of the issue.
set-option -g default-terminal "tmux-256color"
# set-option -g default-terminal "${TERM}" # This is incorrect, do not use.
set-option -sa terminal-overrides ",*:RGB"
set-option -g default-shell /usr/bin/zsh
set-option -g extended-keys on

# set -g prefix None
set -g prefix C-b

unbind C-Space

# bind-key -n C-Space run-shell "~/.config/tmux/scripts/prefix-highlight.sh on" \; switch-client -T prefix
set -g base-index 1              # start indexing windows at 1 instead of 0
set -g detach-on-destroy off     # don't exit from tmux when closing a session
set -g escape-time 0             # zero-out escape time delay
set -g history-limit 1000000     # increase history size (from 2,000)
set -g renumber-windows on       # renumber all windows when any window is closed
set -g set-clipboard on          # use system clipboard
set -g status-position top       # macOS / darwin style
setw -g mode-keys vi

# set -sg repeat-time 1000
# set -g mouse on                  # enable mouse support for wheel events (won't affect normal scrolling)

set -g @thumbs-key e
set -g @thumbs-unique enabled
set -g @thumbs-command 'echo -n {} | wl-copy'

# Keyboard bindings for pane navigation (preserves normal mouse scrolling)
bind-key -n C-M-h run-shell "~/.config/tmux/scripts/select-pane.sh -L"   # Ctrl+Alt+h -> pane left  
bind-key -n C-M-l run-shell "~/.config/tmux/scripts/select-pane.sh -R"   # Ctrl+Alt+l -> pane right
bind-key -n C-M-k run-shell "~/.config/tmux/scripts/select-pane.sh -U"   # Ctrl+Alt+k -> pane up
bind-key -n C-M-j run-shell "~/.config/tmux/scripts/select-pane.sh -D"   # Ctrl+Alt+j -> pane down

# Window management
bind-key W kill-window                                                    # <prefix>+Shift+W -> kill window
bind-key X kill-window                                                    # Alternative: <prefix>+Shift+X -> kill window (for testing)
bind-key Q kill-server
# Removed problematic bindings  
# Removed problematic bindings
# Removed problematic bindings
# Removed problematic bindings

set -g @fzf-url-fzf-options '-p 60%,30% --prompt="   " --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'

# TPM Plugins - MUST be declared BEFORE running TPM
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @plugin 'omerxx/tmux-sessionx'
set -g @plugin 'catppuccin/tmux'
set -g @plugin 'thesast/tmux-transient-status'

# Plugin configuration
set -g @sessionx-bind '^Space'
set -g @sessionx-window-height '85%'
set -g @sessionx-window-width '75%'
set -g @sessionx-zoxide-mode 'on'
set -g @sessionx-filter-current 'false'
set -g @sessionx-preview-enabled 'true'
set -g @continuum-restore 'on'
set -g @resurrect-strategy-nvim 'session'
# set -g @catppuccin_window_left_separator ""
# set -g @catppuccin_window_right_separator " "
set -g @catppuccin_window_middle_separator " █"
set -g @catppuccin_window_number_position "right"
# set -g @catppuccin_window_default_fill "number"
# set -g @catppuccin_window_default_text "#W"
# set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W#{?window_zoomed_flag,(),}"
# set -g @catppuccin_status_modules_right "directory meetings date_time"
# set -g @catppuccin_status_modules_left "session"
# set -g @catppuccin_status_left_separator  " "
# set -g @catppuccin_status_right_separator " "
# set -g @catppuccin_status_right_separator_inverse "no"
# set -g @catppuccin_status_fill "icon"
# set -g @catppuccin_status_connect_separator "no"
# set -g @catppuccin_directory_text "#{b:pane_current_path}"
# set -g @catppuccin_meetings_text "#($HOME/.config/tmux/scripts/cal.sh)"
# set -g @catppuccin_date_time_text "%I:%M"
# set -g @catppuccin_icon_window_last "󰖰"
# set -g @catppuccin_icon_window_current "󰖯"
# set -g @catppuccin_icon_window_zoom "󰁌"
# set -g @catppuccin_icon_window_mark "󰃀"
# set -g @catppuccin_icon_window_silent "󰂛"
# set -g @catppuccin_icon_window_activity "󰖲"
# set -g @catppuccin_icon_window_bell "󰂞"

# Initialize TPM (keep this line at the very bottom of tmux.conf)

# Manual plugin loading (if needed for specific plugins)
run-shell '~/.config/tmux/plugins/tmux-thumbs/tmux-thumbs.tmux'


# Mouse wheel pane resizing (prefix + mousewheel approach, fixed)
# The key insight: create a "resize mode" that stays active for multiple wheel events

# Create a resize mode binding that allows repeated wheel actions
# bind-key R switch-client -T resize_mode

# # Define resize mode key table with wheel bindings
# bind-key -T resize_mode WheelUpPane resize-pane -L 8 \; switch-client -T resize_mode  
# bind-key -T resize_mode WheelDownPane resize-pane -R 8 \; switch-client -T resize_mode
# bind-key -T resize_mode S-WheelUpPane resize-pane -U 8 \; switch-client -T resize_mode
# bind-key -T resize_mode S-WheelDownPane resize-pane -D 8 \; switch-client -T resize_mode
#
# # Exit resize mode with Escape or Enter
# bind-key -T resize_mode Escape switch-client -T root
# bind-key -T resize_mode Enter switch-client -T root
# bind-key -T resize_mode q switch-client -T root
#
# # Also restore normal scrolling within resize mode for other cases
# bind-key -T resize_mode MouseDown1Pane switch-client -T root \; send-keys -M
# bind-key -T resize_mode MouseDrag1Pane switch-client -T root \; send-keys -M

# # # Keep the original wheel behavior for normal operation (restore if modified)
# unbind-key -T root WheelUpPane
# unbind-key -T root WheelDownPane  
# bind-key -T root WheelUpPane if-shell -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" { send-keys -M } { copy-mode -e }
# bind-key -T root WheelDownPane if-shell -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" { send-keys -M } { copy-mode -e }
run '~/.tmux/plugins/tpm/tpm'

# Load custom statusline (comment out catppuccin plugin above to use this)
source-file ~/.config/tmux/statusline.conf
